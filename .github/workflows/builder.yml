name: builder-docker-image-build

on: 
  push: 

  release:
    types: [created]

jobs:
  builder-docker-image-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: docker login
        run: docker login -u ${{ secrets.DOCKERUSERNAME }} -p ${{ secrets.DOCKERAPIKEY }} 
      - name: builder
        env:
          ssh_deploy_key: ukHo+YrG6xulVlk3WuZd9ITOlbUiCKEApWZdy0pHkSb5QvOh4k92aPkQfNYec3Kvy878FaRY4jog2EzYCOfnuuGPilKlywgsEAajr5Ox3wj082D2plRsDVW3UjaHaeUxQjJw5yRPfjd1k3MFJfLrVMS2J8Uf0DzCFlnjAdm77AF+MrQN1HP2XdzWb3AkPqHAE/IgxdJqVf6dlgSerl1cAHhqeLvA2gR4HJPPmPc5OYEH+QCMOmNJ2zONjKd5W3mnZlQwnVJ2AcfT7L7w68uqvS/IulPhWXjFy6VSOYi7HJRxezPzf7thL5W/0z8oCcUPvTgbePNAq+g7N3nP6QGDwdYsTzrWoRTwkcpPkB9biWOwXv+TgAD3PyptWUX9XfgAYfsN4iUBKYqSTiNMsknEdo1YAQCxQomZdELkBfrjxYzXXfeoqv44c2fUUBLso5siDhs+9R1k76JeHFpOObUmwlGBHf/TM9LUhaHTdSSIoscxo44VmHSkx06kUwxvKJVNzRQPJdJQK6phLKf4W4bwiRlX+6mh2Y/El2uTfqv2fNmLVvTpQOa0e5BqO4WpONxWVBIerl//Ccxk3SEdfCbxeLQaDwFeMf0k7NvxF6HNslao0Mp9TutIvYaDWtig+TaVO4X5bA4pNCno0i9EwWcs3MNHFtspCdol3GuSHbM6HO8=
          GITHUB_KEY: GBG1xY1vpnL5Popsq/qNGlFsRdnOut5eEMGM1LgPj2aneOf1ioocbizMjYhzQEMVLqYE0w7gm/DZZogZZ442sKSdRWraCGpwcZt+Xf61WbdzRDGQbTbV8oNlNlsJA51+iM/kY5uHjPkBNJIrZLEcxwEyUCgLKWM0FN1cijgG3NMEwVStoXH+2csOtyENG5bWBe0zZzhA9zK/0FxO/vv1OFjE0ICW1iITmRlMJ1zi/GT9g8hGydCM3DZV3Tr9vOFD2K7QodnlJgujm2PNG9bmDLDGI7AWO49hml5wx8zPQoqMqcWszd+2sgIjSxv18LRzNMnJ6b2tK6l0TohxlmNI1fbfiQih/NomuxjG991Z6ypXCURPWp5n8lqyHYrZ2JGqSd30cxqJGZw7lV65YIl7IMRTNnjEWYrXCz2B5UpZGQ2oFWw80hnQb7xe2jEaWfD9wgEYfIvsMU8L/MpTQE8eC7B/ioU4BQ8GvLoDcolXQEcvJ4YsPXlpPsrYPkZBhE+CGCzUuLY80m1YGU7OQhkrk57wyaMuV5vu5ZFYdGHUTAo2aGqg45XFJjhSgAm/VnS4jv10gK/ZGUzO0+cpzN3jhLkeK3U5JXiYc2+mC/32rtb30gDOYsV64/2nRlXPVuyA1UBDX6M2BDq6MrkRPFFMMmyoMsnqaPGFMNc9Iu0e4lk=
          SSHKEY: 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
        run: |
          export DOCKER_CLI_EXPERIMENTAL=enabled
          repo="rjpadilla/builder"
          sudo apt install qemu-user-static g++-arm-linux-gnueabihf kpartx aria2 tree 
          sudo pip install requests
          echo $USERNAME
          mkdir images && sudo APIKEY=${{ secrets.APIKEY }} USERNAME=${{ secrets.USERNAME }} PATH=./node_modules/.bin:$PATH ./builder --noninteractive  
          echo "${{ secrets.SSHKEY }}" > .travis/id_deploy
          . .travis/environment.sh
          echo "$experiment"
          echo "$image_path"
          cat .travis/id_deploy
          .travis/compress.sh
          ./.travis/upload.sh
